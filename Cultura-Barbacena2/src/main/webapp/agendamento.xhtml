<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="jakarta.faces.facelets">

<ui:composition template="_template.xhtml">

    <ui:define name="conteudo">
        
        <h:form id="formAgendamento">
            <p:growl id="growl" showDetail="false" sticky="false" life="4000" />

            <p:panel header="Novo Agendamento" style="margin-bottom: 20px;">
                <h:panelGrid columns="2" cellpadding="5">
                    
                    <p:outputLabel value="Selecione o Museu:" for="museu" />
                    <p:selectOneMenu id="museu" value="#{agendamentoBean.museuSelecionadoId}" 
                                     required="true" requiredMessage="O Museu é obrigatório" style="width: 250px;">
                        <f:selectItem itemLabel="Selecione..." itemValue="" noSelectionOption="true"/>
                        <f:selectItems value="#{agendamentoBean.listaMuseus}" var="m" 
                                       itemLabel="#{m.nome}" itemValue="#{m.id}"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="Data da Visita:" for="data" />
                    <p:datePicker id="data" value="#{agendamentoBean.agendamento.dataVisita}" 
                                  required="true" showIcon="true" />

                    <p:outputLabel value="Horário:" for="hora" />
                    <p:datePicker id="hora" value="#{agendamentoBean.agendamento.horarioVisita}" 
                                  timeOnly="true" pattern="HH:mm" required="true" showIcon="true"/>

                    <p:outputLabel value="Email Responsável:" for="email" />
                    <p:inputText id="email" value="#{agendamentoBean.agendamento.emailResponsavel}" 
                                 required="true" size="40"/>
                    
                    <p:outputLabel value="Observações:" for="obs" />
                    <p:inputTextarea id="obs" value="#{agendamentoBean.agendamento.observacoes}" rows="3" cols="40"/>
                </h:panelGrid>
            </p:panel>

            <p:panel id="panelPessoa" header="Incluir Visitantes" style="margin-bottom: 20px;">
                
                <h:panelGrid columns="4" cellpadding="5">
                    <p:outputLabel value="Nome:" />
                    <p:inputText value="#{agendamentoBean.pessoa.nome}" />

                    <p:outputLabel value="CPF:" />
                    <p:inputMask value="#{agendamentoBean.pessoa.cpf}" mask="999.999.999-99"/>

                    <p:outputLabel value="Tipo Ingresso:" />
                    <p:selectOneMenu value="#{agendamentoBean.pessoa.tipoIngresso}" style="width: 150px;">
                        <f:selectItem itemLabel="Inteira" itemValue="INTEIRA"/>
                        <f:selectItem itemLabel="Meia" itemValue="MEIA"/>
                        <f:selectItem itemLabel="Isento" itemValue="ISENTO"/>
                    </p:selectOneMenu>

                    <p:commandButton value="Adicionar" icon="pi pi-plus" 
                                     action="#{agendamentoBean.adicionarPessoa}"
                                     process="panelPessoa" 
                                     update="tabelaPessoas panelPessoa growl" 
                                     styleClass="ui-button-secondary"/>
                </h:panelGrid>
            </p:panel>

            <p:dataTable id="tabelaPessoas" value="#{agendamentoBean.agendamento.pessoas}" var="p"
                         emptyMessage="Nenhum visitante adicionado.">
                
                <f:facet name="header">Lista de Visitantes do Grupo</f:facet>

                <p:column headerText="Nome">
                    <h:outputText value="#{p.nome}" />
                </p:column>

                <p:column headerText="CPF">
                    <h:outputText value="#{p.cpf}" />
                </p:column>

                <p:column headerText="Ingresso">
                    <h:outputText value="#{p.tipoIngresso}" />
                </p:column>

                <p:column style="width: 50px; text-align: center;">
                    <p:commandButton icon="pi pi-trash" 
                                     action="#{agendamentoBean.removerPessoa(p)}"
                                     process="@this"
                                     update="tabelaPessoas"
                                     styleClass="ui-button-danger ui-button-flat ui-button-sm"/>
                </p:column>
            </p:dataTable>

            <br/>

            <div style="text-align: center;">
                <p:commandButton value="Confirmar Agendamento Completo" 
                                 action="#{agendamentoBean.gravar}" 
                                 update="@form" 
                                 icon="pi pi-check" 
                                 style="width: 300px; height: 50px; font-weight: bold;"/>
            </div>

        </h:form>

    </ui:define>

</ui:composition>
</html>